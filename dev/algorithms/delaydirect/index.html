<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Delay Direct Method Algorithm · DelaySSAToolkit.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://palmtree2013.github.io/DelaySSAToolkit.jl/algorithms/delaydirect/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.044/juliamono.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">DelaySSAToolkit.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../../tutorials/tutorials/">Tutorials</a></li><li><a class="tocitem" href="../../tutorials/bursty/">A bursty model with delay</a></li><li><a class="tocitem" href="../../tutorials/delay_degradation/">A birth-death example with delay degradation</a></li><li><a class="tocitem" href="../../tutorials/heterogeneous_delay/">A birth-death model with heterogeneous fixed delays</a></li><li><a class="tocitem" href="../../tutorials/delay_oscillator/">An auto-regulatory model of oscillatory gene expression</a></li><li><a class="tocitem" href="../../tutorials/stochastic_delay/">A telegraph model of stochastic delay</a></li></ul></li><li><span class="tocitem">Algorithm</span><ul><li><a class="tocitem" href="../notations/">Notations and Basic Concepts</a></li><li><a class="tocitem" href="../delayrejection/">Delay Rejection Method Algorithm</a></li><li class="is-active"><a class="tocitem" href>Delay Direct Method Algorithm</a><ul class="internal"><li><a class="tocitem" href="#Algorithm"><span>Algorithm</span></a></li><li><a class="tocitem" href="#References"><span>References</span></a></li></ul></li><li><a class="tocitem" href="../delaymnrm/">Delay Modified Next Reaction Method Algorithm</a></li></ul></li><li><a class="tocitem" href="../../theory/">Theory</a></li><li><a class="tocitem" href="../../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Algorithm</a></li><li class="is-active"><a href>Delay Direct Method Algorithm</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Delay Direct Method Algorithm</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/palmtree2013/DelaySSAToolkit.jl/blob/master/docs/src/algorithms/delaydirect.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Delay-Direct-Method-Algorithm"><a class="docs-heading-anchor" href="#Delay-Direct-Method-Algorithm">Delay Direct Method Algorithm</a><a id="Delay-Direct-Method-Algorithm-1"></a><a class="docs-heading-anchor-permalink" href="#Delay-Direct-Method-Algorithm" title="Permalink"></a></h1><p>The number of discarded <span>$\Delta$</span> will be approximately equal to the number of delayed reactions that initiate. This follows because, other than the stored completions at the time the code terminates, every delayed completion will cause one computed <span>$\Delta$</span> to be discarded. Thus, Cai [1] developed an algorithm, called the Direct Method for systems with delays, in which no random variables are discarded.</p><p>The principle of Direct Method is the same as that of the original Gillespie Algorithm and the Rejection Method above: use one random variable to calculate when the next reaction initiates and use another random variable to calculate which reaction occurs at that future time. However, Direct Method updates the state of the system and propensity functions due to stored delayed reactions during the search for the next initiation time. In this way it is ensured that no random variables are discarded as in the Rejection Method. </p><h2 id="Algorithm"><a class="docs-heading-anchor" href="#Algorithm">Algorithm</a><a id="Algorithm-1"></a><a class="docs-heading-anchor-permalink" href="#Algorithm" title="Permalink"></a></h2><p>Suppose that at time <span>$t$</span> there are ongoing delayed reactions set to complete at times <span>$t+T_1, t+T_2, \ldots, t+T_d$</span>. Define <span>$T_0=0$</span> and <span>$T_{d+1}=\infty$</span>.</p><p>Define <em>Tstruct</em>, whose <span>$i$</span>th <span>$(i=1,\dots,d)$</span> row stores <span>$T_i$</span> and the index, <span>$\mu_i$</span>, of the reaction that <span>$T_i$</span> is associated with.</p><ol><li>Initialize. Set the initial number of molecules of each species and set  <span>$t=0$</span>. Clear <em>Tstruct</em>.</li><li>Calculate the propensity of function <span>$a_k$</span>, for each reaction <span>$k \in 1,\ldots, M$</span>.</li><li>Set <span>$a_0=\sum_{k=1}^M{a_k}$</span>.</li><li>Generate  <span>$\Delta$</span>.<ul><li>Input the time <span>$t$</span> and <span>$a_0=\sum_{k=1}^M{a_k}$</span>.</li><li>Generate an independent uniform <span>$(0,1)$</span> random number <span>$r_1$</span>.</li><li>If <em>Tstruct</em> is empty <ul><li>This means there is no ongoing delay reactions, set <span>$\Delta = 1/a_0\ln(1/r_1)$</span>.</li></ul></li><li>Else<ul><li>Set <span>$i=1$</span>, <span>$a_t = a_0T_1$</span> and  <span>$F=1-e^{-a_t}$</span>.</li><li>While <span>$F &lt; r_1$</span><ul><li>Update the state vector <span>$\mathbf{x}$</span> due to the finish of the delayed reaction <span>$t+T_i$</span>.</li><li>Calculate propensity <span>$a_k(t+T_{i+1})$</span> due to the finish of the delayed reaction at <span>$t+T_{i+1}$</span> and calculate <span>$a_0(t+T_{i+1})$</span>.</li><li>Update <span>$a_t=a_t+a_0(t+T_{i+1})(T_{i+1}-T_i)$</span>.</li><li>Update <span>$F=1-e^{-a_t},i=i+1$</span>.</li></ul></li><li>EndWhile</li><li>Calculate propensity <span>$a_k(t+T_i)$</span> due to the finish of the delayed reaction at <span>$t+T_i$</span> and calculate <span>$a_0(t+T_i)$</span>.</li><li>Set <span>$\Delta=T_i-(\ln(1-r_1)+a_t-a_0(t+T_i)(T_{i+1}-T_i))/a_0(t+T_i)$</span>.</li></ul></li><li>EndIf</li></ul></li><li>If <span>$\Delta\in[T_i,T_{i+1})$</span>, delete the columns <span>$1,\ldots,i$</span> of <span>$T_i$</span> and set <span>$T_j=T_j-\Delta$</span>.</li><li>Generate an independent uniform <span>$(0,1)$</span> random number <span>$r_2$</span>.</li><li>Find <span>$\mu\in[1,\dots,m]$</span> such that<p class="math-container">\[\sum_{k=1}^{\mu-1} a_k &lt; r_2 \leq \sum_{k=1}^{\mu}a_k\]</p>where the <span>$a_k$</span> and <span>$a_0$</span> are generated in step 4.</li><li>If <span>$\mu\in \text{ND}$</span> , update the number of each molecular species according to the reaction <span>$\mu$</span>.</li><li>If <span>$\mu\in \text{CD}$</span>, update <em>Tstruct</em> by adding the row <span>$[\tau_\mu,\mu]$</span> so that <span>$Tstruct(i,1)&lt;Tstruct(i+1,1)$</span> still holds for all <strong>i</strong>.</li><li>If <span>$\mu\in \text{ICD}$</span>, update the system according to the initiation of <span>$\mu$</span> and update <em>Tstruct</em> by adding the row <span>$[\tau_\mu,\mu]$</span> so that <span>$Tstruct(i,1)&lt;Tstruct(i+1,1)$</span> still holds for all <span>$i$</span>.</li><li>Set <span>$t=t+\Delta$</span>.</li><li>Return to Step 2 or quit.</li></ol><p>Remark. Notice that in the above pseudo-code, we modified the Step 4 in the orignal algorithm for computational efficiency but both are equivalent.</p><h2 id="References"><a class="docs-heading-anchor" href="#References">References</a><a id="References-1"></a><a class="docs-heading-anchor-permalink" href="#References" title="Permalink"></a></h2><p>[1] Xiaodong Cai, &quot;Exact stochastic simulation of coupled chemical reactions with delays&quot;, The Journal of Chemical Physics 126, 124108(2007). <a href="https://aip.scitation.org/doi/10.1063/1.2710253">https://doi/10.1063/1.2710253</a></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../delayrejection/">« Delay Rejection Method Algorithm</a><a class="docs-footer-nextpage" href="../delaymnrm/">Delay Modified Next Reaction Method Algorithm »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.17 on <span class="colophon-date" title="Thursday 12 May 2022 01:44">Thursday 12 May 2022</span>. Using Julia version 1.7.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
